#!/usr/bin/env python

"""blshift command line
"""

import click as cl
from blshift import Shift, get_codes


@cl.command()
@cl.option('-u', '--user', required=True, help='shift username', envvar='SHIFT_USERNAME')
@cl.option('-p', '--pass', 'password', required=True, help='shift password', envvar='SHIFT_PASSWORD')
@cl.option('-c', '--code', 'codes', help='redeem single shift code, can be used multiple times', multiple=True)
def main(user, password, codes=None):
	"""redeem all active or individual shift codes for Borderlands"""

	with Shift(user, password) as shift:
		if codes:
			codes = [{'code': x['code'], 'reward': x['offer_title_text']} for x in (shift.info(xx) for xx in codes) if x]
		else:
			codes = get_codes()

		for code in codes:
			success, msg = shift.redeem(code['code'])
			msg = f"{cl.style('Success', fg='green') if success else cl.style(msg.replace('_', ' ').title(), fg='red')}"
			cl.echo(f"{cl.style(code['code'], bold=True)} {code['reward']}: {msg}", err=(not success))

if __name__ == '__main__':

	main()
